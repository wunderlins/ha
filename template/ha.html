$def with (recordset, datum)

<!DOCTYPE html>

<html lang="en">
	<head id="head">
	<meta charset="utf-8">
	<title>Holding Area</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="description" content=""/>
	<meta name="author" content="Simon Wunderlin"/>

	<script src="static/jquery-2.1.3.min.js"></script>
	<script src="static/moment.js"></script>
	
	<!-- Bootstrap core CSS -->
	<link href="static/dist/css/bootstrap.min.css" rel="stylesheet"/>
	<link href="static/bootstrap-datetimepicker-master/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>


	<script src="static/dist/js/bootstrap.min.js"></script>
	<script src="static/bootstrap-datetimepicker-master/build/js/bootstrap-datetimepicker.min.js"></script>
              

	<script type="text/javascript">

	function store_check() {
		var inputs = document.getElementsByTagName("input")
		
		var temp = [];
		var filled = [];
		var result = [];
		
		for (i=0; i<inputs.length; i++) {
			var current = inputs[i];
			if (current.type != "checkbox")
				continue;
			
			var nv = current.name.split("_")
			console.log(nv)
			
			var id = nv[1];
			var name = nv[0];
			
			if (!temp[id]) {
				filled[filled.length] = parseInt(id);
				temp[id] = {
					"VENFLON_R": false,
					"VENFLON_L": false,
					"INFUSION_RV": false,
					"INFUSION_3H": false
				}
			}
			
			if (current.checked) {
				var el = "";
				
				switch (name) {
					case "vl":
						el = "VENFLON_L"; break;
					case "vr":
						el = "VENFLON_R"; break;
					case "infrv":
						el = "INFUSION_RV"; break;
					case "inf3h":
						el = "INFUSION_3H"; break;
				}
				
				temp[id][el] = true;
			}
		}
		
		
		console.log(temp)
		console.log(filled)
		
		for (i=0; i<filled.length; i++) {
			var t = temp[filled[i]];
			t.id = filled[i];
			result[result.length] = t;
		}
		
		console.log(result)
		
		$$.ajax({
				method: "POST",
				url: "ha",
				data: JSON.stringify(result)
			})
			.done(function(data) {
				console.log(data)
				if (data.success == false) {
					alert("Fehler in der kommunikation mit dem server, Grund: " + data.message)
				}
			})
			.fail(function() {
				alert( "Daten wurden NICHT gespeichert, Netzwerk Fehler ist aufgetreten." );
			})
		
	}		
	
	
	function init_datepicker() {
		options = {
			pickTime: false,
			format: "DD.MM.YYYY",
			defaultDate: new Date()
		}

		$$('#datum').datetimepicker(options)
	}
	</script>
	<style>
		#datum {width: 18em;}
		body {padding-top: 1em;}
		
		@media print {
			#foot {display: none;}
			/* #dateform  */
		}
	</style>
</head>
<body>


<div class="container">

	<div class="form-group" id="dateform">
		<form action="/ha" method="GET">
		<!-- label for="datum">Datum:</label -->
		<div class='input-group date' id="datum">
			<input type="text" name="datum" value="$datum" class="form-control" />
			<span class="input-group-addon">
				<span class="glyphicon glyphicon-calendar"></span>
			</span>	
			<button type="submit" class="form-control">Anzeigen&nbsp;Â»</button>
		</div>
		</form>
	</div>

	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th colspan="2">Venflon</th>
				<th colspan="2">Infusion</th>
				<th rowspan="2">Geplante OP</th>
				<th rowspan="2">Nachname</th>
				<th rowspan="2">Vorname</th>
				<th rowspan="2">Gebdat</th>
				<th rowspan="2">Saal/Seq</th>
			</tr>
			<tr>
				<th>R</th>
				<th>L</th>
				<th>RV</th>
				<th>3-H</th>
			</tr>
		</thead>

		<tbody>
		$for row in recordset:
			<tr>
				<td>
					<input type="checkbox" 
					$if row[7]:
						checked
					name="vr_$row[6]" />
				</td>
				<td>
					<input type="checkbox" 
					$if row[8]:
						checked
					name="vl_$row[6]" />
				</td>
				<td>
					<input type="checkbox" 
					$if row[9]:
						checked
					name="infrv_$row[6]" />
				</td>
				<td>
					<input type="checkbox" 
					$if row[10]:
						checked
					name="inf3h_$row[6]" />
				</td>
				<td>$row[0]</td>
				<td>$row[1]</td>
				<td>$row[2]</td>
				<td>$row[3]</td>
				<td>$row[4] / $row[5]</td>
			</tr>
		</tbody>
	</table>
	
	<div id="foot">
		<br />
		<button onclick="store_check()" >Speichern</button>

		<hr />
		2015, <a href="mailto:simon.wunderlin@usb.ch">Simon Wunderlin</a>
	</div>
</div>

<script>       
init_datepicker()
</script>
</body>
</html>
